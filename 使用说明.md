
## ps：该数据校验工具用于easyExcel导入时对解析的实体类进行校验 ##

## 使用方式 ##

### 一、导入依赖 ###
```
        <dependency>
            <groupId>com.eagle</groupId>
            <artifactId>excel-import-valid</artifactId>
            <version>1.0.2-RELEASES</version>
        </dependency>
```
### 二、实现easyexcel提供的监听器 ###
```
@Component
@Scope("prototype")
public class SpareImportListener extends AnalysisEventListener<InStorageExcelDTO> {


    @Override
    public void invoke(InStorageExcelDTO inStorageExcelDTO, AnalysisContext analysisContext) {
        //获取行号
        Integer rowIndex = analysisContext.readRowHolder().getRowIndex();
        inStorageExcelDTO.setSerialNumber(rowIndex);
        //处理拿到的数据
        ExcelImportValid.preHandle(inStorageExcelDTO,rowIndex);
    }

    @Override
    public void doAfterAllAnalysed(AnalysisContext analysisContext) {

    }
}
```
###### 在invoke方法中调用校验方法ExcelImportValid.preHandle 入参为excel解析后的实体类和所在行号。 ######
### 三、在实体类中添加相应注解,示例代码如下： ###
```
@Data
@NoArgsConstructor
@AllArgsConstructor
public class InStorageExcelDTO {


    private Integer serialNumber;

    @ExcelProperty(value = "名称")
    @ExcelNotBlank(message = "名称不能为空")
    @ExcelLength(max = 100,message = "名称长度不符")
    private String facilitiesTypeName;

    @ExcelProperty(value = "品牌")
    @ExcelNotBlank(message = "品牌不能为空")
    @ExcelLength(max = 100,message = "品牌长度不符")
    private String brand;

    @ExcelProperty(value = "型号")
    @ExcelLength(max = 200,message = "型号长度不符")
    @ExcelNotBlank(message = "型号不能为空")
    private String modelName;

    @ExcelProperty(value = "数量")
    @ExcelMin(value = 0,message = "数量不能少于0")
    @ExcelNotNull(message = "数量不能为空")
    private Integer inventoryNum;

    @ExcelProperty(value = "单价")
    @ExcelNotNull(message = "单价不能为空")
    private Double cost;

    @ExcelProperty(value = "单位")
    @ExcelNotBlank(message = "单位不能为空")
    @ExcelLength(max = 10,message = "单位长度不符")
    private String unit;
}

```
## 注解说明 ##

```
@ExcelLength 被注释的字符串的大小必须在指定的范围内

@ExcelMax 被注释的元素必须是一个数字，其值必须小于等于指定的最大值

@ExcelMin 被注释的元素必须是一个数字，其值必须大于等于指定的最大值

@ExcelNotBlank 被注释的元素不能为null，可以为空字符串

@ExcelNotNull 被注释的元素不能为null，可以为空字符串

@ExcelPattern 被注释的元素必须是一个字符串，且符合指定的正则表达式。

```

## 组件扩展 ##
###### 为适应不同的业务需求，可在现有组件的基础上扩展新的校验逻辑。下面介绍一下组件扩展的示例流程，供组件维护者查阅 ######
### 一、增加自定义注解 ###
```
@Target({ ElementType.FIELD, ElementType.TYPE })
@Retention(RetentionPolicy.RUNTIME)
public @interface ExcelLength {

     String message() default "{com.eagle.excelvalidation.annotations.ExcelLength.message}";

     int min() default 0;

     int max() default Integer.MAX_VALUE;

}
```
### 二、增加校验方法类，实现ValidationStrategy接口,在validate方法中实现相应的校验逻辑 ###
```
public class LengthValidation implements ValidationStrategy {
    @Override
    public void validate(Object fieldValue, Field field, int rowIndex) throws RuntimeException {
        if (fieldValue instanceof String && fieldValue.toString().length() > field.getAnnotation(ExcelLength.class).max()) {
            throw new RuntimeException("第" + rowIndex + "行数据异常：" + field.getAnnotation(ExcelLength.class).message());
        }   
    }
}

```
### 三、在ValidationFactory工厂类中增加校验类的创建逻辑 ###
```
public class ValidationFactory {
    public static ValidationStrategy getValidationStrategy(Annotation annotation) {
        if (annotation instanceof ExcelNotNull) {
            return new NotNullValidation();
        } else if (annotation instanceof ExcelNotBlank) {
            return new NotBlankValidation();
        } else if (annotation instanceof ExcelLength) {
            return new LengthValidation();
        } else if (annotation instanceof ExcelMax) {
            return new MaxValidation();
        } else if (annotation instanceof ExcelMin) {
            return new MinValidation();
        } else if (annotation instanceof ExcelPattern) {
            return new PatternValidation();
        }
        // 其他注解类型的判断...
        else {
            return null;
        }
    }
}
```
### 四、修改pom文件中的版本号，并发布 ###
```
    <groupId>com.eagle</groupId>
    <artifactId>excel-import-valid</artifactId>
    <version>1.0.2-RELEASES</version>
    
    //执行 mvn clean deploy命令进行发布
```
